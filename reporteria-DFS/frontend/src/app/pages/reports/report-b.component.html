<mat-card>
  <mat-card-title>Reporte B: Clientes, Atenciones y Servicios</mat-card-title>
  <mat-card-content>
    <form [formGroup]="filterForm" (ngSubmit)="applyFilters()" class="filter-form">
      <mat-form-field appearance="outline">
        <mat-label>Fecha Inicio</mat-label>
        <input matInput type="date" formControlName="start_date" />
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Fecha Fin</mat-label>
        <input matInput type="date" formControlName="end_date" />
      </mat-form-field>
      <button mat-raised-button color="primary" type="submit" [disabled]="loading">
        <mat-icon>search</mat-icon>
        Aplicar Filtros
      </button>
    </form>
    <div *ngIf="loading" class="loading-container">
      <mat-spinner></mat-spinner>
    </div>
    <mat-card *ngIf="error" class="error-card">
      <mat-card-content>
        <mat-icon color="warn">error</mat-icon>
        <p>{{ error }}</p>
      </mat-card-content>
    </mat-card>
    <div *ngIf="!loading && data.length">
      <table mat-table [dataSource]="data" class="full-width-table">
        <ng-container matColumnDef="client">
          <th mat-header-cell *matHeaderCellDef>Cliente</th>
          <td mat-cell *matCellDef="let row">{{ row.client.full_name }}</td>
        </ng-container>
        <ng-container matColumnDef="total_attentions">
          <th mat-header-cell *matHeaderCellDef>Atenciones</th>
          <td mat-cell *matCellDef="let row">{{ row.summary.total_attentions }}</td>
        </ng-container>
        <ng-container matColumnDef="total_services">
          <th mat-header-cell *matHeaderCellDef>Servicios</th>
          <td mat-cell *matCellDef="let row">{{ row.summary.total_services }}</td>
        </ng-container>
        <ng-container matColumnDef="total_amount">
          <th mat-header-cell *matHeaderCellDef>Monto</th>
          <td mat-cell *matCellDef="let row">{{ row.summary.total_amount }}</td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
      <div class="summary" *ngIf="summary">
        <p><strong>Total clientes:</strong> {{ summary.total_clients }}</p>
        <p><strong>Total atenciones:</strong> {{ summary.total_attentions }}</p>
        <p><strong>Total servicios:</strong> {{ summary.total_services }}</p>
        <p><strong>Total monto:</strong> {{ summary.total_revenue }}</p>
      </div>
      <button mat-stroked-button color="accent" (click)="exportCSV()">
        <mat-icon>download</mat-icon>
        Exportar CSV
      </button>
    </div>
  </mat-card-content>
</mat-card>
